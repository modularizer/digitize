<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>digitize demo</title>
    <style>
      :root{
        --bg: #0b1020;
        --card: rgba(255,255,255,.06);
        --card2: rgba(255,255,255,.08);
        --text: rgba(255,255,255,.92);
        --muted: rgba(255,255,255,.70);
        --line: rgba(255,255,255,.12);
        --accent: #7c5cff;
        --accent2:#22c55e;

        --radius: 16px;
        --radius2: 12px;
        --shadow: 0 18px 55px rgba(0,0,0,.45);
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body{
        margin:0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        background:
          radial-gradient(1400px 700px at 15% 10%, rgba(124,92,255,.22), transparent 55%),
          radial-gradient(900px 500px at 80% 25%, rgba(34,197,94,.14), transparent 60%),
          radial-gradient(900px 700px at 60% 95%, rgba(245,158,11,.12), transparent 55%),
          var(--bg);
        color: var(--text);
      }

      a { color: inherit; }
      .wrap{
        max-width: 1400px;
        margin: 22px auto;
        padding: 0 18px;
      }

      header{
        display:flex;
        align-items:flex-start;
        justify-content:space-between;
        gap: 14px;
        margin-bottom: 14px;
      }

      .title{ display:flex; flex-direction:column; gap: 6px; }
      h1{ margin:0; font-size: 22px; letter-spacing: .2px; }
      .sub{
        margin:0;
        color: var(--muted);
        font-size: 13px;
        line-height: 1.35;
        max-width: 70ch;
      }

      .pillbar{
        display:flex;
        gap:10px;
        flex-wrap:wrap;
        justify-content:flex-end;
        align-items:center;
      }
      .pill{
        display:inline-flex;
        align-items:center;
        gap:8px;
        padding: 8px 10px;
        border: 1px solid var(--line);
        background: rgba(255,255,255,.03);
        border-radius: 999px;
        color: var(--muted);
        font-size: 12px;
      }
      .dot{
        width:8px;height:8px;border-radius:999px;
        background: var(--accent2);
        box-shadow: 0 0 0 4px rgba(34,197,94,.12);
      }

      .grid{
        display:grid;
        grid-template-columns: 1.8fr .5fr;
        gap: 14px;
        margin-top: 14px;
        min-height: calc(100vh - 120px);
        align-items: stretch;
      }

      .card{
        border: 1px solid var(--line);
        background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: clip;

        display:flex;
        flex-direction:column;
        min-height:0;
      }
      .card .hd{
        padding: 14px 14px 10px;
        border-bottom: 1px solid var(--line);
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap: 10px;
      }
      .card .hd h2{ margin:0; font-size: 14px; letter-spacing: .2px; }
      .card .hd .meta{
        color: var(--muted);
        font-size: 12px;
        display:flex;
        gap: 10px;
        align-items:center;
      }
      .card .bd{ padding: 14px; flex:1 1 auto; min-height:0; }

      textarea{
        width: 100%;
        height: 110px;
        font-size: 14px;
        line-height: 1.35;
        padding: 12px 12px;
        border-radius: var(--radius2);
        border: 1px solid var(--line);
        background: rgba(0,0,0,.25);
        color: var(--text);
        outline: none;
        resize: vertical;
      }
      textarea:focus{
        border-color: rgba(124,92,255,.55);
        box-shadow: 0 0 0 4px rgba(124,92,255,.16);
      }

      .chips{
        display:flex;
        gap: 8px;
        flex-wrap:wrap;
        margin-top: 10px;
      }
      .chip{
        font-size: 11px;
        padding: 6px 9px;
        border-radius: 999px;
        border: 1px solid var(--line);
        background: rgba(255,255,255,.03);
        color: var(--muted);
        cursor:pointer;
        user-select:none;
      }
      .chip:hover{
        background: rgba(255,255,255,.06);
        color: rgba(255,255,255,.86);
      }

      .btnrow{
        display:flex;
        gap:10px;
        flex-wrap:wrap;
        justify-content:flex-end;
        margin-top: 12px;
      }
      button{
        border: 1px solid var(--line);
        background: rgba(255,255,255,.06);
        color: var(--text);
        padding: 8px 10px;
        border-radius: 14px;
        cursor:pointer;
        font-weight: 600;
        font-size: 12px;
        transition: transform .08s ease, background .18s ease, border-color .18s ease;
      }
      button:hover{ background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.18); }
      button:active{ transform: translateY(1px); }
      .primary{
        background: linear-gradient(180deg, rgba(124,92,255,.90), rgba(124,92,255,.65));
        border-color: rgba(124,92,255,.85);
      }
      .primary:hover{ background: linear-gradient(180deg, rgba(124,92,255,.98), rgba(124,92,255,.72)); }
      .ghost{ background: rgba(0,0,0,.18); }

      pre{
        margin:0;
        padding: 12px;
        border-radius: var(--radius2);
        border: 1px solid rgba(255,255,255,.12);
        background: rgba(0,0,0,.35);
        color: rgba(255,255,255,.92);
        overflow:auto;
        font-size: 13px;
        line-height: 1.45;
        min-height: 150px;
        white-space: pre-wrap;
        word-break: break-word;
      }

      details{
        border: 1px solid var(--line);
        border-radius: var(--radius2);
        background: rgba(255,255,255,.03);
        overflow: clip;
      }
      details summary{
        cursor:pointer;
        padding: 10px 12px;
        font-size: 12px;
        color: var(--muted);
        list-style:none;
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap: 10px;
      }
      details[open] summary{ border-bottom: 1px solid var(--line); }
      details summary::-webkit-details-marker{ display:none; }
      .kbadge{
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 999px;
        background: rgba(124,92,255,.18);
        border: 1px solid rgba(124,92,255,.32);
        color: rgba(255,255,255,.90);
      }
      .json{ padding: 12px; margin:0; border-radius: 0 0 var(--radius2) var(--radius2); }

      /* ==== viewport / scrolling fixes ==== */
      .splitCol{
        display:flex;
        flex-direction:column;
        gap:12px;
        min-height:0;
      }
      .paneTop{ flex:0 0 auto; }
      .paneScroll{
        flex:1 1 auto;
        min-height:0;
        overflow:auto;
        padding-right:4px;
      }

      .outCol{
        display:flex;
        flex-direction:column;
        gap:8px;
        min-height:0;
      }
      .outActions{ flex:0 0 auto; display:flex; justify-content:flex-end; }
      #out{
        flex:1 1 auto;
        min-height:160px;
        max-height:260px;
        overflow:auto;
      }
      .rightCard .bd{ padding: 10px 12px 12px; }

      /* ==========================================================
         PARAMS: VERY CONCISE, ONE ROW PER PARAM, 3 COLS
         ========================================================== */

      .controls{
        display:grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 6px 10px;
        align-items:center;
      }

      /* each param is a single row: label + control (or label + toggle) */
      .param{
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap: 10px;
        min-height: 30px;
        padding: 6px 8px;
        border: 1px solid var(--line);
        border-radius: 10px;
        background: rgba(255,255,255,.03);
        line-height: 1.2;
      }

      .param .k{
        font-size: 12px;
        font-weight: 600;
        color: rgba(255,255,255,.88);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 55%;
      }

      .param input[type="text"],
      .param input[type="number"],
      .param select{
        width: 48%;
        min-width: 120px;
        padding: 6px 8px;
        border-radius: 9px;
        border: 1px solid var(--line);
        background: rgba(0,0,0,.20);
        color: var(--text);
        outline:none;
        font-size: 12px;
        line-height: 1.2;
      }
      .param select:focus,
      .param input[type="text"]:focus,
      .param input[type="number"]:focus{
        border-color: rgba(124,92,255,.55);
        box-shadow: 0 0 0 4px rgba(124,92,255,.16);
      }

      /* compact toggle (still one row) */
      .param .switch{
        width: 38px;
        height: 22px;
        flex: 0 0 auto;
      }
      .param .switch input{
        appearance:none;
        width:100%;
        height:100%;
        margin:0;
        outline:none;
        border-radius: 999px;
        background: rgba(255,255,255,.12);
        border: 1px solid var(--line);
        cursor:pointer;
        transition: .18s ease;
      }
      .param .switch input:checked{
        background: rgba(34,197,94,.35);
        border-color: rgba(34,197,94,.55);
      }
      .param .switch .knob{
        position:absolute;
        top: 50%;
        left: 4px;
        transform: translateY(-50%);
        width: 14px;
        height: 14px;
        border-radius: 999px;
        background: rgba(255,255,255,.92);
        box-shadow: 0 10px 25px rgba(0,0,0,.35);
        transition: .18s ease;
        pointer-events:none;
      }
      .param .switch input:checked + .knob{ left: 18px; }

      /* breaks should be full width row */
      .param.full{ grid-column: 1 / -1; }
      .param.full .k{ max-width: 25%; }
      .param.full input{ width: 72%; }

      @media (max-width: 1100px){
        .controls{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid{ grid-template-columns: 1.35fr .65fr; }
      }
      @media (max-width: 640px){
        .controls{ grid-template-columns: 1fr; }
        .grid{ grid-template-columns: 1fr; }
        #out{ max-height: 220px; }
        .param input[type="text"], .param input[type="number"], .param select{
          width: 55%;
          min-width: 0;
        }
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <header>
        <div class="title">
          <h1>digitize demo</h1>
          <p class="sub">
            Convert number-words to digits and (optionally) evaluate simple math. All params exposed below —
            run is live-ish as you type.
          </p>
        </div>

        <div class="pillbar">
          <div class="pill"><span class="dot"></span> window.digitize available</div>
          <div class="pill">Operators: <code>power</code>, <code>mult</code>, <code>div</code></div>
        </div>
      </header>

      <div class="grid">
        <!-- LEFT -->
        <section class="card leftCard" id="leftCard">
          <div class="hd">
            <h2>Input & Params</h2>
            <div class="meta"><span id="status">ready</span></div>
          </div>

          <div class="bd splitCol">
            <div class="paneTop">
              <textarea id="in">square root of five plus one and a half</textarea>

              <div class="chips" aria-label="Examples">
                <div class="chip" data-ex="two to the one hundred twenty-seventh power">2^(127)</div>
                <div class="chip" data-ex="Traffic hit 10K requests per second.">10K suffix</div>
                <div class="chip" data-ex="third time was the charm">nth time</div>
                <div class="chip" data-ex="two point eight multiplied by twenty two point 7">decimals + multiply</div>
                <div class="chip" data-ex="square root of 5">root</div>
                <div class="chip" data-ex="pi">pi</div>
                <div class="chip" data-ex="two pi">2 pi</div>
              </div>

              <div class="btnrow">
                <button class="ghost" id="copyCfg">Copy params JSON</button>
                <button class="ghost" id="reset">Reset</button>
                <button class="primary" id="run">Run</button>
              </div>
            </div>

            <div class="paneScroll">
              <div class="controls">
                <!-- selects/text/num -->
                <div class="param"><div class="k">config</div>
                  <select id="config">
                    <option value="default" selected>default</option>
                    <option value="token">token</option>
                    <option value="strip">strip</option>
                    <option value="num">num</option>
                    <option value="norm">norm</option>
                  </select>
                </div>

                <div class="param"><div class="k">fmt</div><input id="fmt" type="text" value="%n" /></div>

                <div class="param"><div class="k">literalFmt</div>
                  <select id="literalFmt">
                    <option value="" selected>auto</option>
                    <option value="true">true</option>
                    <option value="false">false</option>
                  </select>
                </div>

                <div class="param"><div class="k">fmtMultipliers</div><input id="fmtMultipliers" type="text" placeholder="(blank)" /></div>
                <div class="param"><div class="k">fmtOrdinal</div><input id="fmtOrdinal" type="text" placeholder="(blank)" /></div>

                <div class="param"><div class="k">repSignifiers</div>
                  <select id="repSignifiers">
                    <option value="COMPLEX_REP_PATTERN" selected>COMPLEX</option>
                    <option value="SIMPLE_REP_PATTERN">SIMPLE</option>
                    <option value="times?">times?</option>
                    <option value="/times?/i">/times?/i</option>
                  </select>
                </div>

                <div class="param"><div class="k">fmtRep</div><input id="fmtRep" type="text" placeholder="(blank)" /></div>
                <div class="param"><div class="k">fmtNthTime</div><input id="fmtNthTime" type="text" placeholder="(blank)" /></div>
                <div class="param"><div class="k">repFmt</div><input id="repFmt" type="text" value="time" /></div>

                <div class="param"><div class="k">power</div><input id="power" type="text" value="**" /></div>
                <div class="param"><div class="k">mult</div><input id="mult" type="text" value="*" /></div>
                <div class="param"><div class="k">div</div><input id="div" type="text" value="/" /></div>

                <div class="param"><div class="k">combineAdd</div>
                  <select id="combineAdd">
                    <option value="" selected>auto</option>
                    <option value="true">true</option>
                    <option value="false">false</option>
                  </select>
                </div>

                <div class="param"><div class="k">res</div><input id="res" type="number" value="10" min="0" max="2000" /></div>

                <div class="param full"><div class="k">breaks</div><input id="breaks" type="text" placeholder="e.g. ,|;|:" /></div>

                <!-- bool toggles (still one row each) -->
                <div class="param"><div class="k">useCommas</div>
                  <label class="switch"><input id="useCommas" type="checkbox" /><span class="knob"></span></label>
                </div>

                <div class="param"><div class="k">replaceMultipliers</div>
                  <label class="switch"><input id="replaceMultipliers" type="checkbox" checked /><span class="knob"></span></label>
                </div>

                <div class="param"><div class="k">supportOrdinals</div>
                  <label class="switch"><input id="supportOrdinals" type="checkbox" checked /><span class="knob"></span></label>
                </div>

                <div class="param"><div class="k">supportReps</div>
                  <label class="switch"><input id="supportReps" type="checkbox" checked /><span class="knob"></span></label>
                </div>

                <div class="param"><div class="k">repFmtPlural</div>
                  <label class="switch"><input id="repFmtPlural" type="checkbox" checked /><span class="knob"></span></label>
                </div>

                <div class="param"><div class="k">attemptToDifferentiateSeconds</div>
                  <label class="switch"><input id="attemptToDifferentiateSeconds" type="checkbox" checked /><span class="knob"></span></label>
                </div>

                <div class="param"><div class="k">supportRoman</div>
                  <label class="switch"><input id="supportRoman" type="checkbox" /><span class="knob"></span></label>
                </div>

                <div class="param"><div class="k">parseSigns</div>
                  <label class="switch"><input id="parseSigns" type="checkbox" checked /><span class="knob"></span></label>
                </div>

                <div class="param"><div class="k">doSimpleEvals</div>
                  <label class="switch"><input id="doSimpleEvals" type="checkbox" checked /><span class="knob"></span></label>
                </div>

                <div class="param"><div class="k">doFractionEvals</div>
                  <label class="switch"><input id="doFractionEvals" type="checkbox" checked /><span class="knob"></span></label>
                </div>
              </div>

              <details style="margin-top:12px;">
                <summary>
                  <span>Current params payload</span>
                  <span class="kbadge" id="paramCount">0 keys</span>
                </summary>
                <pre class="json" id="cfgJson"></pre>
              </details>
            </div>
          </div>
        </section>

        <!-- RIGHT -->
        <section class="card rightCard" id="rightCard">
          <div class="hd">
            <h2>Output</h2>
            <div class="meta">
              <span id="charCount">0 chars</span>
              <span>·</span>
              <span id="wordCount">0 words</span>
              <span>·</span>
              <span id="latency">—</span>
            </div>
          </div>

          <div class="bd outCol">
            <div class="outActions">
              <button class="ghost" id="copyOut">Copy output</button>
            </div>
            <pre id="out"></pre>
          </div>
        </section>
      </div>
    </div>

    <script src="./dist/bundle.js"></script>
    <script>
      const $ = (id) => document.getElementById(id);

      const SIMPLE_REP_PATTERN = String.raw`(?:time|occurence|instance)s?`;
      const COMPLEX_REP_PATTERN = String.raw`(?:time|occurence|instance|attempt|try|tries)s?(?: (?:at|of))?(?: (?:which|when))?`;

      const defaults = {
        config: "default",
        useCommas: false,
        fmt: "%n",
        replaceMultipliers: true,
        fmtMultipliers: "",
        supportOrdinals: true,
        fmtOrdinal: "",
        repSignifiers: "COMPLEX_REP_PATTERN",
        supportReps: true,
        fmtRep: "",
        fmtNthTime: "",
        repFmt: "time",
        repFmtPlural: true,
        attemptToDifferentiateSeconds: true,
        literalFmt: false,
        supportRoman: false,
        parseSigns: true,
        power: "**",
        mult: "*",
        div: "/",
        combineAdd: true,
        res: 10,
        doSimpleEvals: true,
        doFractionEvals: true,
        breaks: ""
      };

      function parseBoolSelect(id) {
        const v = $(id).value;
        if (v === "") return undefined;
        return v === "true";
      }

      function resolveRepSignifiers(v){
        const s = (v || "").trim();
        if (!s) return undefined;
        if (s === "COMPLEX_REP_PATTERN") return COMPLEX_REP_PATTERN;
        if (s === "SIMPLE_REP_PATTERN") return SIMPLE_REP_PATTERN;

        if (s.startsWith("/") && s.lastIndexOf("/") > 0){
          const last = s.lastIndexOf("/");
          const body = s.slice(1, last);
          const flags = s.slice(last+1);
          try { return new RegExp(body, flags); } catch (e) {}
        }
        return s;
      }

      function resolveBreaks(v){
        const s = (v || "").trim();
        if (!s) return undefined;
        if (s.includes("|")) return s.split("|").filter(Boolean);
        return s;
      }

      function buildParams(){
        const cfg = $("config").value;

        const params = {
          config: cfg,
          useCommas: $("useCommas").checked,
          fmt: $("fmt").value,

          replaceMultipliers: $("replaceMultipliers").checked,
          fmtMultipliers: $("fmtMultipliers").value || undefined,

          supportOrdinals: $("supportOrdinals").checked,
          fmtOrdinal: $("fmtOrdinal").value || undefined,

          repSignifiers: resolveRepSignifiers($("repSignifiers").value),
          supportReps: $("supportReps").checked,
          fmtRep: $("fmtRep").value || undefined,
          fmtNthTime: $("fmtNthTime").value || undefined,
          repFmt: $("repFmt").value,
          repFmtPlural: $("repFmtPlural").checked,

          attemptToDifferentiateSeconds: $("attemptToDifferentiateSeconds").checked,

          literalFmt: parseBoolSelect("literalFmt"),
          supportRoman: $("supportRoman").checked,

          parseSigns: $("parseSigns").checked,

          power: $("power").value,
          mult: $("mult").value,
          div: $("div").value,

          combineAdd: parseBoolSelect("combineAdd"),
          res: Number($("res").value),

          doSimpleEvals: $("doSimpleEvals").checked,
          doFractionEvals: $("doFractionEvals").checked,

          breaks: resolveBreaks($("breaks").value),
        };

        for (const k of Object.keys(params)){
          if (params[k] === undefined) delete params[k];
        }
        return params;
      }

      function updateMeta(){
        const input = $("in").value || "";
        $("charCount").textContent = `${input.length} chars`;
        const words = input.trim() ? input.trim().split(/\s+/).length : 0;
        $("wordCount").textContent = `${words} words`;
      }

      function showCfg(params){
        $("cfgJson").textContent = JSON.stringify(params, (k,v)=>{
          if (v instanceof RegExp) return `/${v.source}/${v.flags}`;
          return v;
        }, 2);
        $("paramCount").textContent = `${Object.keys(params).length} keys`;
      }

      async function copyText(txt){
        try{
          await navigator.clipboard.writeText(txt);
          $("status").textContent = "copied";
          setTimeout(()=> $("status").textContent = "ready", 700);
        }catch(e){
          $("status").textContent = "copy failed";
          setTimeout(()=> $("status").textContent = "ready", 900);
        }
      }

      function run(){
        const t0 = performance.now();
        $("status").textContent = "running…";

        const input = $("in").value;
        const params = buildParams();
        showCfg(params);

        let output = "";
        try{
          output = window.digitize(input, params);
        }catch(e){
          output = `Error: ${e && e.message ? e.message : String(e)}`;
        }

        $("out").textContent = output;

        const dt = performance.now() - t0;
        $("latency").textContent = `${dt.toFixed(1)} ms`;
        $("status").textContent = "ready";
        updateMeta();
      }

      function reset(){
        $("config").value = defaults.config;
        $("useCommas").checked = defaults.useCommas;
        $("fmt").value = defaults.fmt;

        $("replaceMultipliers").checked = defaults.replaceMultipliers;
        $("fmtMultipliers").value = defaults.fmtMultipliers;

        $("supportOrdinals").checked = defaults.supportOrdinals;
        $("fmtOrdinal").value = defaults.fmtOrdinal;

        $("repSignifiers").value = defaults.repSignifiers;
        $("supportReps").checked = defaults.supportReps;
        $("fmtRep").value = defaults.fmtRep;
        $("fmtNthTime").value = defaults.fmtNthTime;
        $("repFmt").value = defaults.repFmt;
        $("repFmtPlural").checked = defaults.repFmtPlural;

        $("attemptToDifferentiateSeconds").checked = defaults.attemptToDifferentiateSeconds;

        $("literalFmt").value = "false";
        $("supportRoman").checked = defaults.supportRoman;

        $("parseSigns").checked = defaults.parseSigns;

        $("power").value = defaults.power;
        $("mult").value = defaults.mult;
        $("div").value = defaults.div;

        $("combineAdd").value = "true";
        $("res").value = defaults.res;

        $("doSimpleEvals").checked = defaults.doSimpleEvals;
        $("doFractionEvals").checked = defaults.doFractionEvals;

        $("breaks").value = defaults.breaks;

        run();
      }

      $("run").addEventListener("click", run);
      $("reset").addEventListener("click", reset);

      $("copyOut").addEventListener("click", () => copyText($("out").textContent || ""));
      $("copyCfg").addEventListener("click", () => copyText($("cfgJson").textContent || ""));

      document.querySelectorAll(".chip").forEach((el) => {
        el.addEventListener("click", () => {
          $("in").value = el.getAttribute("data-ex") || "";
          run();
        });
      });

      const rerunIds = [
        "in","config","useCommas","fmt","replaceMultipliers","fmtMultipliers",
        "supportOrdinals","fmtOrdinal","repSignifiers","supportReps","fmtRep","fmtNthTime",
        "repFmt","repFmtPlural","attemptToDifferentiateSeconds","literalFmt","supportRoman",
        "parseSigns","power","mult","div","combineAdd","res","doSimpleEvals","doFractionEvals","breaks"
      ];
      rerunIds.forEach((id) => {
        const el = $(id);
        const evt = (el && (el.tagName === "SELECT" || el.type === "checkbox")) ? "change" : "input";
        el.addEventListener(evt, () => {
          clearTimeout(window.__t);
          window.__t = setTimeout(run, 120);
          updateMeta();
        });
      });

      updateMeta();
      run();
    </script>
  </body>
</html>
